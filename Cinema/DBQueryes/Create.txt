create schema IF NOT EXISTS cinemaDB;
use cinemadb;

CREATE TABLE Utente (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nomeUtente VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    ruolo ENUM('Cliente', 'Gestore') NOT NULL
);

CREATE TABLE Film (
    id INT AUTO_INCREMENT PRIMARY KEY,
    titolo VARCHAR(255) NOT NULL,
    orario TIME NOT NULL
);

CREATE TABLE Sala (
    id INT AUTO_INCREMENT PRIMARY KEY,
    numeroSala INT NOT NULL UNIQUE,
    posti INT NOT NULL
);

CREATE TABLE SalaFilm (
    id INT AUTO_INCREMENT PRIMARY KEY,
    idSala INT NOT NULL,
    idFilm INT NOT NULL,
    orarioProiezione TIME NOT NULL,
    FOREIGN KEY (idSala) REFERENCES Sala(id) ON DELETE CASCADE,
    FOREIGN KEY (idFilm) REFERENCES Film(id) ON DELETE CASCADE
);


CREATE TABLE Prenotazione (
    id INT AUTO_INCREMENT PRIMARY KEY,
    idCliente INT NOT NULL,
    idSalaFilm INT NOT NULL,
    dataPrenotazione TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (idCliente) REFERENCES Utente(id) ON DELETE CASCADE,
    FOREIGN KEY (idSalaFilm) REFERENCES SalaFilm(id) ON DELETE CASCADE
);
